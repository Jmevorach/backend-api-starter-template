# Dependabot configuration for automatic dependency updates
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates

version: 2
updates:
  # Elixir/Mix dependencies
  - package-ecosystem: "mix"
    directory: "/app"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 10
    commit-message:
      prefix: "deps(elixir)"
    labels:
      - "dependencies"
      - "elixir"
    groups:
      phoenix:
        patterns:
          - "phoenix*"
          - "plug*"
      ecto:
        patterns:
          - "ecto*"
          - "postgrex"
      telemetry:
        patterns:
          - "telemetry*"
      auth:
        patterns:
          - "ueberauth*"
      dev-tools:
        patterns:
          - "dialyxir"
          - "credo"
          - "excoveralls"
          - "mix_audit"

  # Python dependencies (Lambda functions)
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "deps(python)"
    labels:
      - "dependencies"
      - "python"
    groups:
      linting:
        patterns:
          - "ruff"
          - "mypy"
          - "bandit"
      aws:
        patterns:
          - "boto3*"

  # GitHub Actions
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "ci(actions)"
    labels:
      - "dependencies"
      - "github-actions"
    groups:
      actions:
        patterns:
          - "*"

  # Terraform providers (main infrastructure)
  - package-ecosystem: "terraform"
    directory: "/infra"
    schedule:
      interval: "weekly"
      day: "tuesday"
    open-pull-requests-limit: 5
    commit-message:
      prefix: "deps(terraform)"
    labels:
      - "dependencies"
      - "terraform"
    groups:
      aws-providers:
        patterns:
          - "hashicorp/aws"
          - "hashicorp/random"

  # Terraform state backend
  - package-ecosystem: "terraform"
    directory: "/state-backend"
    schedule:
      interval: "monthly"
    open-pull-requests-limit: 2
    commit-message:
      prefix: "deps(terraform)"
    labels:
      - "dependencies"
      - "terraform"

  # Docker base images (app)
  - package-ecosystem: "docker"
    directory: "/app"
    schedule:
      interval: "weekly"
      day: "tuesday"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "deps(docker)"
    labels:
      - "dependencies"
      - "docker"

  # Docker Compose (root)
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "tuesday"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "deps(docker)"
    labels:
      - "dependencies"
      - "docker"

  # DevContainer features
  - package-ecosystem: "devcontainers"
    directory: "/.devcontainer"
    schedule:
      interval: "monthly"
    open-pull-requests-limit: 3
    commit-message:
      prefix: "deps(devcontainer)"
    labels:
      - "dependencies"
      - "devcontainer"
    groups:
      devcontainer-features:
        patterns:
          - "*"
